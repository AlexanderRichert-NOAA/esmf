# $Id: base,v 1.3 2002/11/26 21:00:16 jwolfe Exp $ 
#
include ${ESMF_DIR}/build/${ESMF_ARCH}/base_variables
include ${ESMF_DIR}/build/common

#########

.F90.o:
	${FC} -c ${C_FC_MOD}${ESMC_MODDIR} ${FOPTFLAGS} -free -cpp ${FFLAGS} ${FCPPFLAGS} ${ESMC_INCLUDE} $<

.F.o:
	${FC} -c ${C_FC_MOD}${ESMC_MODDIR} ${FOPTFLAGS} -free  ${FFLAGS} ${ESMC_INCLUDE} $<

.f90.o:
	${FC} -c ${FOPTFLAGS} -extend_source -cpp ${FFLAGS} ${FCPPFLAGS} ${ESMC_INCLUDE} $<

.f.o:
	${FC} -c ${FOPTFLAGS} -extend_source ${FFLAGS} ${ESMC_INCLUDE} $<

.c.o:
	${CC} -c ${COPTFLAGS} ${CFLAGS} ${CCPPFLAGS} ${ESMC_INCLUDE} $<

.C.o:
	${CXX} -c ${COPTFLAGS} ${CFLAGS} ${CCPPFLAGS} ${ESMC_INCLUDE} $<

.F90.a:
	${FC} -c ${C_FC_MOD}${ESMC_MODDIR} ${FOPTFLAGS} -free -cpp ${FFLAGS} ${FCPPFLAGS} ${ESMC_INCLUDE} $<
	${AR} ${AR_FLAGS} ${LIBNAME} $*.o
	${RM} $*.o

.F.a:
	${FC} -c ${C_FC_MOD}${ESMC_MODDIR} ${FOPTFLAGS} -free ${FFLAGS} ${ESMC_INCLUDE} $<
	${AR} ${AR_FLAGS} ${LIBNAME} $*.o
	${RM} $*.o

.f90.a:
	${FC} -c ${FOPTFLAGS} -extend_source -cpp ${FFLAGS} ${FCPPFLAGS} ${ESMC_INCLUDE} $<
	${AR} ${AR_FLAGS} ${LIBNAME} $*.o
	${RM} $*.o

.f.a:
	${FC} -c ${FOPTFLAGS} -extend_source ${FFLAGS} ${ESMC_INCLUDE} $<
	${AR} ${AR_FLAGS} ${LIBNAME} $*.o
	${RM} $*.o

.c.a:
	${CC} -c ${COPTFLAGS} ${CFLAGS} ${CCPPFLAGS} ${ESMC_INCLUDE} $<
	${AR} ${AR_FLAGS} ${LIBNAME} $*.o
	${RM} $*.o

.C.a:
	${CXX} -c ${COPTFLAGS} ${CFLAGS} ${CCPPFLAGS} ${ESMC_INCLUDE} $<
	${AR} ${AR_FLAGS} ${LIBNAME} $*.o
	${RM} $*.o
#
#  Generates a shared library from any .a library
#  This is to allow any user to generate his or her own shared library
#

shared: chkopts_basic
	-@echo making shared libraries in ${LDIR} ;\
	cd ${LDIR}; \
	for LIBNAME in ${SHLIBS} ; \
	do \
	  if [ -f ${LDIR}/$$LIBNAME.a ]; then \
	    flag=""; \
	    if [ -f ${LDIR}/$$LIBNAME.${SLSUFFIX} ]; then \
	      flag=`find ${LDIR} -type f -name $$LIBNAME.a -newer ${LDIR}/$$LIBNAME.${SLSUFFIX} -print`; \
	    else \
	      flag="true"; \
	    fi; \
	    if [ "$$flag" != "" ]; then \
	      echo "building $$LIBNAME.${SLSUFFIX}"; \
	      ${LD} -shared  -all  $$LIBNAME.a  -o $$LIBNAME.${SLSUFFIX}  > /dev/null2>&1; \
	    fi; \
	  fi; \
	done
#
#  Generates a shared library from any .a library
#  This is to allow any user to generate his or her own shared library
#

oshared:
	-@echo "building $$LIBNAME.${SLSUFFIX}"
	-@${LD} -shared  -all  ${LIBNAME}.a  -o ${LIBNAME}.${SLSUFFIX}  > /dev/null 2>&1
