#!/bin/csh -f
#
# Earth System Modeling Framework
# Copyright 2002-2003, University Corporation for Atmospheric Research, 
# Massachusetts Institute of Technology, Geophysical Fluid Dynamics 
# Laboratory, University of Michigan, National Centers for Environmental 
# Prediction, Los Alamos National Laboratory, Argonne National Laboratory, 
# NASA Goddard Space Flight Center.
# Licensed under the GPL.
#
# $Id: do_latex,v 1.12 2004/03/05 01:47:52 eschwab Exp $
#
#===============================================================================
# do_latex
#===============================================================================
# Build document with bibliography if available. 
#
# Usage: do_latex <comp> <document type>
#
#        <comp> is the name of the component, library, or module used as the
#               basis for document filenames (e.g., coupler)
#
#        <document type> is one of the following:
#               req  - requirements document
#               arch - architecture document
#               des  - detailed design document        
#               ref  - reference manual
#               usr  - user's guide
#               phys - algorithmic or physical description
#
# C. DeLuca                                                       March 15, 2000
#===============================================================================

if ($#argv != 2) then
  echo "Usage: do_latex <component> <document type>"
  exit
endif

# if needed, pre-process as top-level constituent or standalone document
if (-e $1_$2doc.ctex) then

  # move original out of the way
  if (-e $1_$2doc.tex) then
    mv $1_$2doc.tex $1_$2doc.tex.ORIG
  endif

  # perform pre-processing
  if($1 == "ESMF") then
echo "here1"
    cpp -C -P -DCONSTITUENT $1_$2doc.ctex | grep -v "^#pragma" > $1_$2doc.tex
    cpp -C -P $1.cbib | grep -v "^#pragma" > $1.bib
  else
    cpp -C -P -DSTANDALONE $1_$2doc.ctex | grep -v "^#pragma" > $1_$2doc.tex
echo "here2"
  endif

endif

if ($1 == "ESMF") then
echo "here3"
  cp $1.bib $1_$2doc.bib
  latex $1_$2doc.tex
  latex $1_$2doc.tex
  bibtex $1_$2doc
  latex $1_$2doc.tex
  bibtex $1_$2doc
  latex $1_$2doc.tex
  rm -f $1_$2doc.bib
else 
echo "here4"
  cp $1.bib $1_$2doc.bib
  latex $1_$2doc.tex
  latex $1_$2doc.tex
  bibtex $1_$2doc
  latex $1_$2doc.tex
  bibtex $1_$2doc
  latex $1_$2doc.tex
  rm -f $1_$2doc.bib
endif
