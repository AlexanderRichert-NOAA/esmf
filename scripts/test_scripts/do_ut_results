# $Id: do_ut_results,v 1.2 2003/04/04 22:19:12 svasquez Exp $
#!/bin/ksh
# This script runs at the enf of the "run_tests" and "run_tests_uni" targets.
# The purpose is to give the user the results of running the unit tests.
echo ""
echo "The following is the analysis of the Unit Tests results:"
echo ""

find $ESMF_DIR/test/testg/$ESMF_ARCH -name "*UTest" -print | wc -l > stdoutfiles
if grep -q " 0" stdoutfiles # check if there are any unit tests executable files 
then
	echo "There are no executable Unit test files, either the 'gmake BOPT=g/O build_tests' has "
	echo "not been run or the 'build_tests' did not build successfully."
	echo "" 
else
	echo "Executable unit tests found:"
	find $ESMF_DIR/test/testg/$ESMF_ARCH -name "*UTest" -print
	echo "" 
	echo "All of these executable unit tests should have a corresponding stdout file." 
	echo "If not, it's an indication that the unit test was not executed, or that it failed to execute." 
	echo "" 

fi # end of if grep " 0" stdoutfiles

find $ESMF_DIR/test/testg/$ESMF_ARCH -name "*UTest*.stdout" -print | wc -l > stdoutfiles
if grep -q " 0" stdoutfiles
then
	echo "There are no Unit Test stdout files." 
	echo "" 
else
	echo "Unit Tests stdout files found: " 
	ls -l $ESMF_DIR/test/testg/$ESMF_ARCH/*UTest*.stdout 
	echo "" 
	echo "Unit test stdout files of zero length indicate that the unit test" 
	echo "did not run because it failed to compile or it failed to execute. " 
	echo "" 
	if grep -q FAIL $ESMF_DIR/test/testg/$ESMF_ARCH/*UTest*.stdout
	then
		echo "The following Unit Tests Failed: "  
		grep FAIL $ESMF_DIR/test/testg/$ESMF_ARCH/*UTest*.stdout
		echo "" 
	else
		find $ESMF_DIR/test/testg/$ESMF_ARCH -name "*UTest*.stdout"  -size 0 -print | wc -l > zerofiles
		if diff stdoutfiles zerofiles #check if all the stdoutfiles are of zero length
		then
			echo ""
		else
			echo "No Unit Test failures were found." 
			echo "" 

		fi #end of if diff stdoutfiles zerofiles

	fi #end of if grep FAIL $ESMF_DIR/test/testg/$ESMF_ARCH/*UTest*.stdout

fi #end of if grep " 0" stdoutfiles
rm -f stdoutfiles
rm -f zerofiles

