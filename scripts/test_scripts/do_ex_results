# $Id: do_ex_results,v 1.2 2004/01/20 18:15:55 svasquez Exp $
#!/bin/ksh
# This script runs at the end of the "run_example" target.
# The purpose is to give the user the results of running the examples.
echo ""
echo "The following is the analysis of the run examples results:"
echo ""

find $ESMF_DIR/examples/examples$ESMF_BOPT/$ESMF_ARCH.$ESMF_COMPILER.$ESMF_PREC.$ESMF_SITE -name "*Ex" -print | wc -l > stdoutfiles
if grep " 0" stdoutfiles > NULL # check if there are any examples executable files 
then
	echo "There are no executable examples files, either the 'gmake ESMF_BOPT=g/O build_examples' has "
	echo "not been run or the 'build_examples' did not build successfully."
	echo "" 
else
	echo "Executable examples found:"
	cd $ESMF_DIR/examples/examples$ESMF_BOPT/$ESMF_ARCH.$ESMF_COMPILER.$ESMF_PREC.$ESMF_SITE
	ls -l *Ex 
	cd $ESMF_DIR
	echo "" 
	echo "All of the executable examples should have a corresponding stdout file." 
	echo "If not, it's an indication that the examples ere not executed, or that it failed to execute." 
	echo "" 

fi # end of if grep " 0" stdoutfiles

find $ESMF_DIR/examples/examples$ESMF_BOPT/$ESMF_ARCH.$ESMF_COMPILER.$ESMF_PREC.$ESMF_SITE -name "*Ex.stdout" -print | wc -l > stdoutfiles
if grep  " 0" stdoutfiles > NULL
then
	echo "There are no examples stdout files." 
	echo "" 
else
	echo "Examples stdout files found: " 
	cd $ESMF_DIR/examples/examples$ESMF_BOPT/$ESMF_ARCH.$ESMF_COMPILER.$ESMF_PREC.$ESMF_SITE
	ls -l *Ex.stdout 
	cd $ESMF_DIR
	echo "" 
	echo "Example stdout files of zero length indicate that the example" 
	echo "did not run because it failed to compile or it failed to execute. " 
	echo "" 
	if grep "PASS:" $ESMF_DIR/examples/examples$ESMF_BOPT/$ESMF_ARCH.$ESMF_COMPILER.$ESMF_PREC.$ESMF_SITE/*Ex.stdout > NULL
	then
		echo "The following examples passed: "  
		cd $ESMF_DIR/examples/examples$ESMF_BOPT/$ESMF_ARCH.$ESMF_COMPILER.$ESMF_PREC.$ESMF_SITE
		grep -l "PASS:" *Ex.stdout
		cd $ESMF_DIR
		echo "" 
 	else
		echo "No examples passed." 
		echo "" 
	fi #end of if grep PASS ...

        echo ""
	if grep  "FAIL:" $ESMF_DIR/examples/examples$ESMF_BOPT/$ESMF_ARCH.$ESMF_COMPILER.$ESMF_PREC.$ESMF_SITE/*Ex.stdout > NULL
	then
		echo "The following examples failed: "  
		cd $ESMF_DIR/examples/examples$ESMF_BOPT/$ESMF_ARCH.$ESMF_COMPILER.$ESMF_PREC.$ESMF_SITE
		grep -l "FAIL:" *Ex.stdout
		cd $ESMF_DIR
		echo "" 
	else
		find $ESMF_DIR/examples/examples$ESMF_BOPT/$ESMF_ARCH.$ESMF_COMPILER.$ESMF_PREC.$ESMF_SITE -name "*Ex.stdout"  -size 0 -print | wc -l > zerofiles
		if diff stdoutfiles zerofiles  > NULL #check if all the stdoutfiles are of zero length
		then
			echo ""
		else
			echo "No examples Failed." 
			echo "" 

		fi #end of if diff stdoutfiles zerofiles

	fi #end of if grep FAIL $ESMF_DIR/examples/examples$ESMF_BOPT/$ESMF_ARCH.$ESMF_PREC.$ESMF_SITE/*Ex.stdout

fi #end of if grep " 0" stdoutfiles
rm -f stdoutfiles
rm -f zerofiles
rm -f NULL

