% $Id: LogErr_implnotes.tex,v 1.4 2004/03/16 20:04:12 cdeluca Exp $
%
% Earth System Modeling Framework
% Copyright 2002-2003, University Corporation for Atmospheric Research, 
% Massachusetts Institute of Technology, Geophysical Fluid Dynamics 
% Laboratory, University of Michigan, National Centers for Environmental 
% Prediction, Los Alamos National Laboratory, Argonne National Laboratory, 
% NASA Goddard Space Flight Center.
% Licensed under the GPL.

%\subsection{Implementation Notes}

\begin{enumerate}

\item The Log class was implemented in C/C++, but uses the Fortran I/O libraries when
the class methods are called from Fortran. We forced the C/C++ methods 
to use the Fortran I/O library by creating 
utility functions that are written in Fortran, but callable from Log's C++ methods.
These utility functions call the standard Fortran write, open and close functions.
If you call the Log methods from C/C++ code, you bypass the utility functions
and all I/O is done with the C I/O libraries.

At initialization an ESMF_LogArray is created.  This array is a container that holds multiple ESMF_Logs.  Within the ESMF_LogArray, one or more ESMF_Logs may be created.  Each ESMF_Log stores information for a specific Log file.   When working with more than one Log file, multiple ESMF_Logs are required (one ESMF_Log for each log file).  For each ESMF_Log, a handle is returned through the ESMF_LogOpen method so that the user can manage the various Logs.  The properties of a specific Log are set with the ESMF_LogSet method.  Additionally, buffering occurs within ESMF_Log.  Every time the ESMF_LogWrite method is called, a LogEntry element is populated with the ESMF_LogWrite information.  The user can set the number of LogEntry elements in the Log buffer.  When the buffer is full (i.e., when all the LogEntry elements are populated), the buffer will be flushed and all the contents will be written.  If buffering is not needed (autoflush=false), the ESMF_LogWrite will immediately write to the Log files.  To close a Log, the ESMF_LogClose method is called.  To open a previously closed Log, the ESMF_LogReopen method is called.

Buffering allows ESMF to manage output data streams in a desired way.  For instance, a solution to clean streaming pe_ordered output would be to gather the buffers on root pe when flushing and order and stream them as desired by the user.  Buffering the output provides a layer where the output can be managed.  Writing to the buffer is transparent to the user because all the Log entries are handled automatically by the ESMF_LogWrite method. 

\end{enumerate}




