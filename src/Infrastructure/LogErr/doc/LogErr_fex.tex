% $Id: LogErr_fex.tex,v 1.6 2004/06/07 06:57:53 cpboulder Exp $
%
% Earth System Modeling Framework
% Copyright 2002-2003, University Corporation for Atmospheric Research, 
% Massachusetts Institute of Technology, Geophysical Fluid Dynamics 
% Laboratory, University of Michigan, National Centers for Environmental 
% Prediction, Los Alamos National Laboratory, Argonne National Laboratory, 
% NASA Goddard Space Flight Center.
% Licensed under the GPL.

%\subsection{Use and Examples}

Options will be set later.
\begin{enumerate}
\item {\tt verbose} - Whether error messages should be written (default: {\tt ESMF\_TRUE}).
\item {\tt flush} - Whether output should be flushed (default:  {\tt ESMF\_FALSE}).
\item {\tt haltOnErr} - Whether to halt on an error (default:  {\tt ESMF\_TRUE}).
\item {\tt haltOnWarn} - Whether to halt on a warning (default:  {\tt ESMF\_FALSE}).
\end {enumerate}

\subsubsection{Example 1. Simple Example.}

In this example we use the default {\tt ESMF\_Log\_World} object and 
illustrate the {\tt ESMF\_LogGetUnit} to write to the log file 
{\tt aLog.txt}.

{\tt
\begin{verbatim}
program test_log

  use ESMF_Mod
  implicit none
  integer myDE
  .....
  call ESMF_LogOpenFile(ESMF_Log_World,ESMF_SINGLE_LOG_FILE,"aLog.txt")
  if (myDE .eq. 0) write(ESMF_LogGetUnit(ESMF_Log_World),*) "This is a test."
  call ESMF_LogCloseFile(ESMF_Log_World)

end program
\end{verbatim}
\tt}

\subsubsection{Example 2. Simple Error Handling.}

Here we illustrate simple error handling.  We define an error handler, 
{\tt anErr}, and set its options.  Error output goes to the file 
{\tt anErr.txt}.  A standard error message is written to the Log.  

{\tt
\begin{verbatim}

type(ESMF_Log) :: anErr
integer returnCode 
call ESMF_LogSet(anErr, verbose=ESMF_TRUE, flush=ESMF_FALSE,   &
                 haltOnErr=ESMF_TRUE, haltOnWarn=ESMF_FALSE)
call ESMF_LogOpenFile(anErr, ESMF_SINGLE_LOG_FILE, "anErr.txt")
returnCode=foo()
if (returnCode == ESMF_FATAL) call ESMF_LogErr(anErr, returnCode) 
call ESMF_LogCloseFile(anErr)
\end{verbatim}
\tt}

\subsubsection{Example 3. Using the LogSet and LogGet routines}

In this example, we illustrate more complex error handling.  We use
{\tt ESMF\_LogGet} to get the value of {\tt verbose}, and if it's set to 
{\tt ESMF\_TRUE} then we turn off verbose midway through the code.  This allows 
you to put in lots of debugging code, and if you want to turn the debugging
messages off, you can call {\tt ESMF\_LogSet} rather than commenting out all 
the error handling calls.  We also illustrate the use of {\tt ESMF\_LogErrMsg},
which writes an additional message to the Log file.

{\tt
\begin{verbatim}

type(ESMF_Log) :: anErr
type(ESMF_Logical) :: myVerbosity
character(len=32) :: myMsg
integer returnCode 

call ESMF_LogSet(anErr, verbose=ESMF_TRUE, flush=ESMF_FALSE,   &
                 haltOnErr=ESMF_TRUE, haltOnWarn=ESMF_FALSE)
call ESMF_LogOpenFile(anErr,ESMF_SINGLE_LOG_FILE,"anErr.txt")

returnCode=foo()

myMsg="This will be written out."

if (returnCode == ESMF_FATAL) call ESMF_LogErrMsg(anErr, returnCode,myMsg) 

ESMF_LogGet(anErr,verbose=myVerbosity)

if (myVerbosity==ESMF_TRUE) call ESMF_LogSet(verbose=ESMF_FALSE)

myMsg="This will not be written out."
returnCode=foo()

if (returnCode == ESMF_FATAL) call ESMF_LogErrMsg(anErr, returnCode,myMsg)
call ESMF_LogCloseFile(anErr)

\end{verbatim}
\tt}

\subsubsection{Example 4. Writing to Multiple Log Files }

In this example, we show how one can write to multiple Log files,
by using two ESMF\_Log file handles.  One writes to multiple files and the
other writes to one master file. Writing to multiple files is important 
when you want output from each DE saved to an individual file. 
As illustrated in the example below, while the name of the file is set to
aLogMult.txt, the Log tool will automatically append the DE rank to
the name. Consequently, if you run this example on, say, six
DEs, six files will be produced: aLogMaster.txt.1, aLogMaster.txt.2,
aLogMaster.txt.3, aLogMaster.txt.4, aLogMaster.txt.5, aLogMaster.txt.6.

{\tt
\begin{verbatim}

type(ESMF_Log) :: aLogMaster, aLogMult
integer myDE

call ESMF_LogOpenFile(aLogMaster,ESMF_SINGLE_LOG_FILE,"aLogMas.txt")
call ESMF_LogOpenFile(aLogMult,ESMF_MULT_LOG_FILE,"aLogMult.txt")
if (myDE .eq. 0) write(ESMF_LogGetUnit(aLogMaster),*) "We are writing to the master file."
write(ESMF_LogGetUnit(aLogMult),*) "We are writing to the multiple files."
call ESMF_LogCloseFile(aLogMaster)
write(ESMF_LogGetUnit(aLogMult),*) "While we closed &
the master file, we are still writing to the aLogMult file handle. "
call ESMF_LogCloseFile(aLogMult)

\end{verbatim}
\tt}





