% $Id: PerfProf_req.tex,v 1.7 2002/05/15 23:29:08 cnh Exp $

\req{Code Section Timing}

The profiler will have a means to time individual code sections.  An API will be 
provided so that a user may insert calls to the profiler at the beginning and
end of a passage of interest.

\begin{reqlist}
{\bf Priority:} \\
{\bf Source:} CAM-EUL, CAM-FV, CLM, CCSM-CPL, POP, CICE, PSAS, MIT \\
{\bf Status:} Proposed \\
{\bf Verification:} Code Inspection \\
{\bf Notes:} 
\end{reqlist}

\sreq{Named Timers}

Calls for recording time may be placed around numerous different code sections, 
and the library shall provide a means for distinguishing these separate calls.  When
the results of the timing are reported, each timer will be associated with its name.

\begin{reqlist}
{\bf Priority:} \\
{\bf Source:} CAM-EUL, CAM-FV, CLM, CCSM-CPL, POP, CICE, PSAS, MIT \\
{\bf Status:} Proposed \\
{\bf Verification:} Code Inspection \\
{\bf Notes:} 
\end{reqlist}

\ssreq{Named Timer Reset}

A named timer may be reset at any time.  All data will be cleared.

\begin{reqlist}
{\bf Priority:} \\
{\bf Source:} MIT \\
{\bf Status:} Proposed \\
{\bf Verification:} Code Inspection \\
{\bf Notes:} 
\end{reqlist}

\sreq{Types of Time}

In the context of the profiler the word ``time'' is not well defined.  There are
a number of different types of ``time'' that may be of interest to a profiler.
These various types of time can be recorded.  Each will be recorded separately and reported
as such.  The various types are enumerated below:

\ssreq{User Time}

Process user time can be recorded.
The timer will provide a means to estimate and reconcile the extra time added by its usage.

\begin{reqlist}
{\bf Priority:}  \\
{\bf Source:} CAM-EUL, CAM-FV, CLM, CCSM-CPL, POP, CICE, PSAS, MIT \\
{\bf Status:} Proposed \\
{\bf Verification:} Code Inspection \\
{\bf Notes:} It is desirable to offer a mechanism which removes the
  intrusiveness of the timing calls themselves; there are mechanisms
  to estimate the timing call overhead (WS).
  
\end{reqlist}

\ssreq{System Time}

System time can be recorded.

\begin{reqlist}
{\bf Priority:}  \\
{\bf Source:} CAM-EUL, CAM-FV, CLM, CCSM-CPL, POP, CICE, PSAS, MIT \\
{\bf Status:} Proposed \\
{\bf Verification:} Code Inspection \\
{\bf Notes:} 
\end{reqlist}


\ssreq{Wall Time}

Wall clock time can be recorded.

\begin{reqlist}
{\bf Priority:}  \\
{\bf Source:} CAM-EUL, CAM-FV, CLM, CCSM-CPL, POP, CICE, PSAS, MIT \\
{\bf Status:} Proposed \\
{\bf Verification:} Code Inspection \\
{\bf Notes:} 
\end{reqlist}


\req{Hardware Counters}

Most computers have special registers which keep track of information such
as floating point operations, cycles, and cache hits/misses.  The profiler will
provide a high level interface for accessing these registers.
Collection of the following data will be supported, where available:
\begin{itemize}
\item{Floating Point Ops}
\item{Cache Utilization}
\item{Cache Misses}
\item{Floating Point Unit Utilization}
\item{Cycle Counts}
\end{itemize}

\begin{reqlist}
{\bf Priority:}  \\
{\bf Source:} CAM-EUL, CAM-FV, CLM, CCSM-CPL, POP, CICE, PSAS, MIT \\
{\bf Status:} Proposed \\
{\bf Verification:} Code Inspection \\
{\bf Notes:} 
\end{reqlist}

\req{Process Granularity}

The profiler will be able to operate within a nested structure of processes (e.g.
from MPI process 3, thread 6).

\begin{reqlist}
{\bf Priority:}  \\
{\bf Source:}  CAM-FV, POP, CICE, PSAS, MIT \\
{\bf Status:} Proposed \\
{\bf Verification:} Code Inspection \\
{\bf Notes:} 
\end{reqlist}

\sreq{Process Level}

The profiler can be called safely from any process (MPI or other).  It will 
identify and report which process it was called from.

\begin{reqlist}
{\bf Priority:}  \\
{\bf Source:} CAM-EUL, CAM-FV, CLM, CCSM-CPL, POP, CICE, PSAS, MIT \\
{\bf Status:} Proposed \\
{\bf Verification:} Code Inspection \\
{\bf Notes:} 
\end{reqlist}

\sreq{Thread Level}

The profiler can be called safely from any thread.  It will 
identify and report which thread it was called from.

\begin{reqlist}
{\bf Priority:}  \\
{\bf Source:} CAM-EUL, CAM-FV, CLM, CCSM-CPL, POP, CICE, PSAS, MIT \\
{\bf Status:} Proposed \\
{\bf Verification:} Code Inspection \\
{\bf Notes:} 
\end{reqlist}

\req{Reporting}

The profiler will provide a means to output the data collected.  This output may
be called at any point of execution, as many times as desired.

\sreq{Log Output}

The profiler will write its output via the Log.  

\begin{reqlist}
{\bf Priority:}  \\
{\bf Source:}  MIT \\
{\bf Status:} Proposed \\
{\bf Verification:} Code Inspection \\
{\bf Notes:} 
\end{reqlist}

\sreq{API Retrieval}

The profiler data will be accessible to the program by means of an API.
\begin{reqlist}
{\bf Priority:}  \\
{\bf Source:} MIT  \\
{\bf Status:} Proposed \\
{\bf Verification:} Code Inspection \\
{\bf Notes:} 
\end{reqlist}

\sreq{Statistics}

The profiler will be able to perform a variety of statistical analysis on its call
data and report.

\ssreq{Thread Statistics}

A named timer can perform analysis across threads and report the 
minimum amount of time spent in any thread, the maximum, and the mean.

\begin{reqlist}
{\bf Priority:}  \\
{\bf Source:}  MIT \\
{\bf Status:} Proposed \\
{\bf Verification:} Code Inspection \\
{\bf Notes:} 
\end{reqlist}

\req{Call Deactivation}

Calling profiling routines typically has a performance impact and should not
be done during production runs.  Therefore there will be some mechanisms to 
disable the profiling calls.

\sreq{Compile Deactivation}

The library can be turned into stub calls at compile time.

\begin{reqlist}
{\bf Priority:}  \\
{\bf Source:} CAM-EUL, CAM-FV, CLM, CCSM-CPL, PSAS, MIT \\
{\bf Status:} Proposed \\
{\bf Verification:} Code Inspection \\
{\bf Notes:} 
\end{reqlist}

\sreq{Runtime Deactivation}

A flag may be set so that calls to the profiling library do no more than check
this flag and return.

\begin{reqlist}
{\bf Priority:}  \\
{\bf Source:} CAM-EUL, CAM-FV, CLM, CCSM-CPL, POP, CICE, PSAS, MIT \\
{\bf Status:} Proposed \\
{\bf Verification:} Code Inspection \\
{\bf Notes:} It is particularly useful to be able to do some timing
early on in a run to predict time to completion and then have
the timing switch itself off.
\end{reqlist}

