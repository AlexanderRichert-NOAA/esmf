% $Id: PerfProf_req.tex,v 1.10 2002/12/06 19:02:45 vbalaji Exp $

\req{Code section timing}

The profiler will have a means to time individual code sections.  An API will be 
provided so that a user may insert calls to the profiler at the beginning and
end of a passage of interest.

\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:} CAM-EUL, CAM-FV, CLM, CCSM-CPL, POP, CICE, PSAS, MIT \\
{\bf Status:} Approved-1 \\
{\bf Verification:} Unit-test \\
{\bf Notes:} 
\end{reqlist}

\sreq{Synchronized timers}

For load balance measurement, there must be a flag to synchronize
timers across a PElist at the beginning of a code section.

\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:} GFDL \\
{\bf Status:} Approved-1 \\
{\bf Verification:} Unit-test \\
{\bf Notes:} 
\end{reqlist}

\sreq{Named timers}

Calls for recording time may be placed around numerous different code sections, 
and the library shall provide a means for distinguishing these separate calls.  When
the results of the timing are reported, each timer will be associated with its name.

\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:} CAM-EUL, CAM-FV, CLM, CCSM-CPL, POP, CICE, PSAS, MIT \\
{\bf Status:} Approved-1 \\
{\bf Verification:} Unit-test \\
{\bf Notes:} 
\end{reqlist}

\ssreq{Named timer reset}

A named timer may be reset at any time.  All data will be cleared.

\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:} MIT, CAM-FV \\
{\bf Status:} Approved-1 \\
{\bf Verification:} Unit-test \\
{\bf Notes:} 
\end{reqlist}

\sreq{Types of time}

There are
a number of different types of ``time'' that may be of interest to a profiler.
These various types of time can be recorded.  Each will be recorded separately and reported
as such.  The various types are enumerated below:

\ssreq{User time}

Process user time can be recorded.
The timer will provide a means to estimate and reconcile the extra time added by its usage.

\begin{reqlist}
{\bf Priority:} 2 \\
{\bf Source:} CAM-EUL, CAM-FV, CLM, CCSM-CPL, POP, CICE, PSAS, MIT \\
{\bf Status:} Approved-2 \\
{\bf Verification:} Unit-test \\
{\bf Notes:} It is desirable to offer a mechanism which removes the
  intrusiveness of the timing calls themselves; there are mechanisms
  to estimate the timing call overhead (WS).
  
\end{reqlist}

\ssreq{System time}

System time can be recorded.

\begin{reqlist}
{\bf Priority:} 2 \\
{\bf Source:} CAM-EUL, CAM-FV, CLM, CCSM-CPL, POP, CICE, PSAS, MIT \\
{\bf Status:} Approved-2 \\
{\bf Verification:} Unit-test \\
{\bf Notes:} 
\end{reqlist}


\ssreq{Wall clock time}

Wall clock time can be recorded.

\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:} CAM-EUL, CAM-FV, CLM, CCSM-CPL, POP, CICE, PSAS, MIT \\
{\bf Status:} Approved-1 \\
{\bf Verification:} Unit-test \\
{\bf Notes:} 
\end{reqlist}


\req{Hardware counters}

Most computers have special registers which keep track of information such
as floating point operations, cycles, and cache hits/misses.  The profiler will
provide a high level interface for accessing these registers.
Collection of the following data will be supported, where available:
\begin{itemize}
\item{Floating Point Ops}
\item{Memory Ops}
\item{Cache Utilization}
\item{Cache Misses}
\item{Floating Point Unit Utilization}
\item{Cycle Counts}
\end{itemize}

\begin{reqlist}
{\bf Priority:} 2 \\
{\bf Source:} CAM-EUL, CAM-FV, CLM, CCSM-CPL, POP, CICE, PSAS, MIT \\
{\bf Status:} Approved-1 \\
{\bf Verification:} Unit-test\\
{\bf Notes:} 
\end{reqlist}

\req{Process granularity}

The profiler will be able to operate within a nested structure of processes (e.g.
from MPI process 3, thread 6).

\begin{reqlist}
{\bf Priority:} 2 \\
{\bf Source:}  CAM-FV, POP, CICE, PSAS, MIT \\
{\bf Status:} Approved-2 \\
{\bf Verification:} Unit-test \\
{\bf Notes:} 
\end{reqlist}

\sreq{Process level}

The profiler can be called safely from any process (MPI or other).  It will 
identify and report which process it was called from.

\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:} CAM-EUL, CAM-FV, CLM, CCSM-CPL, POP, CICE, PSAS, MIT \\
{\bf Status:} Approved-1 \\
{\bf Verification:} Unit-test \\
{\bf Notes:} 
\end{reqlist}

\sreq{Thread level}

The profiler can be called safely from any thread.  It will 
identify and report which thread it was called from.

\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:} CAM-EUL, CAM-FV, CLM, CCSM-CPL, POP, CICE, PSAS, MIT \\
{\bf Status:} Approved-1 \\
{\bf Verification:} Unit-test \\
{\bf Notes:} 
\end{reqlist}

\req{Communication profiling}

The profiler shall be able to profile communication by maintaining
statistics on inter-processor communication to assess utilization of
memory. In particular, the statistics must include a profile of
messages sizes and times between a pair of caliper points.

\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:} CAM-EUL, CAM-FV, CLM, CCSM-CPL, POP, CICE, PSAS, MIT \\
{\bf Status:} Approved-1 \\
{\bf Verification:} Unit-test \\
{\bf Notes:} 
\end{reqlist}

\req{Reporting}

The profiler will provide a means to output the data collected.  This
output may be called at any point of execution, as many times as
desired.

\sreq{Log output}

The profiler will write its output via the log.  

\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:}  MIT \\
{\bf Status:} Approved-1 \\
{\bf Verification:} Code Inspection \\
{\bf Notes:} 
\end{reqlist}

\sreq{API retrieval}

The profiler data will be accessible to the program by means of an API.
\begin{reqlist}
{\bf Priority:} 2 \\
{\bf Source:} MIT  \\
{\bf Status:} Approved-2 \\
{\bf Verification:} Unit-test \\
{\bf Notes:} 
\end{reqlist}

\sreq{Statistics}

The profiler will be able to perform a variety of statistical analysis
on its call data and report.

\ssreq{Thread statistics}

A named timer can perform analysis across threads and report the 
minimum amount of time spent in any thread, the maximum, the standard
deviation, and the mean.

\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:}  MIT, CAM-EUL, CLM, CCSM-CPL \\
{\bf Status:} Approved-1 \\
{\bf Verification:} Unit-test \\
{\bf Notes:} 
\end{reqlist}

\req{Call deactivation}

Calling profiling routines typically has a performance impact and should not
be done during production runs.  Therefore there will be some mechanisms to 
disable the profiling calls.

\sreq{Compile deactivation}

The library can be turned into stub calls at compile time.

\begin{reqlist}
{\bf Priority:}  \\
{\bf Source:} CAM-EUL, CAM-FV, CLM, CCSM-CPL, PSAS, MIT \\
{\bf Status:} Rejected \\
{\bf Verification:} Code Inspection \\
{\bf Notes:} Can be implimented using CPP in user-code.
\end{reqlist}

\sreq{Runtime deactivation}

A flag may be set so that calls to the profiling library do no more than check
this flag and return.

\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:} CAM-EUL, CAM-FV, CLM, CCSM-CPL, POP, CICE, PSAS, MIT \\
{\bf Status:} Approved-1 \\
{\bf Verification:} Code Inspection \\
{\bf Notes:} It is particularly useful to be able to do some timing
early on in a run to predict time to completion and then have
the timing switch itself off.
\end{reqlist}

