% $Id: Bundle_usage.tex,v 1.2 2004/03/16 00:06:05 cdeluca Exp $

%\subsection{Use and Examples}

Bundles offer a way to group Fields which share a common Grid, and 
optionally to pack the Field data together in a single buffer.  The
``packing'' feature is useful for optimizing collective operations and
communications.  By sending a set of Fields together as a package,
the latencies associated with sending Fields individually is avoided.

The Bundle class depends on the underlying Field class for most of its
communication and querying functions.  The information maintained 
by the Bundle class is a list of constituent Fields, and whether 
there is a packed Array at the Bundle level.

Memory layout information is stored in a DataMap object which
is attached to the Bundle.  It can be accessed by querying the Bundle.

The Bundle class contains multiple Fields which share a
common or compatible Grid object.  In addition to the basic methods for
setting, retrieving, and querying the constituent Fields, it provides
methods for configuring and querying memory layouts for the Array
and some limited collective operations on all Fields in a Bundle.

\subsubsection{Bundle Creation}

After creating multiple Fields, Bundles can be created
by calling the {\tt ESMF\_BundleCreate()} subroutine.  There are
options to create a Bundle which simply references
the data buffers of the existing Fields, or the Bundle can pack 
all the data associated with its constituent Fields into a 
separate, contiguous buffer.  If a data copy is made, there are options to
control the interleaving of the Field data in the Bundle data buffer.

\subsubsection{Accessing Bundle Data}

Access to Bundles with packed data is similar to data access
for Fields.  To access data in a Bundle which is not packed, the 
user must loop over the Fields in the Bundles, querying for each
constituent Field and then using the Field level data interfaces.

\subsubsection{Bundle Deletion}

If Bundles are used, the user must call the 
{\tt ESMF\_BundleDestroy()} subroutine before deleting any constituent
Fields.  If a packed Bundle data buffer exists, the space is
freed and all resources associated with the Bundle are released.
The constituent Fields and their data are not deleted by this call, 
since they can be contained by multiple Bundles.
