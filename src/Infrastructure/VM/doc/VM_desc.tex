% $Id: VM_desc.tex,v 1.10 2009/09/30 20:28:22 theurich Exp $

The {\tt ESMF\_VM} (Virtual Machine) class is a generic representation of hardware and system software resources. There is exactly one VM object per ESMF component, providing the execution environment for the component code. The VM object handles all resource management tasks of a component and provides a description of the underlying configuration of the compute resources used by the component. The basic elements of a VM are called PETs, which stands for Persistent Execution Threads.  These are equivalent to OS threads with a lifetime of at least that of the associated component. All VM functionality is expressed in terms of PETs. In the simplest, and most common case, a PET is equivalent to an MPI process. However, ESMF also supports multi-threading, where multiple PETs are running as Pthreads inside the same virtual address space (VAS).

The resource management functions of the VM class become visible when a component creates sub-components. There are two parts to resource management, the parent and the child. When the parent component creates a child component, the parent VM object provides the resources on which the child can be created with {\tt ESMF\_GridCompCreate()} or {\tt ESMF\_CplCompCreate()}. The optional {\tt petList} argument to these calls can be used to limit the resources that the parent gives to a specific child. The child component, on the other hand, may specify - during its optional SetVM() method - how it wants to arrange the inherited resources in its own VM. All registered methods of the component will henceforth execute in the thus defined child VM. Notice that the SetVM() routine, although part of the child component, executes {\em before} the child VM has been started up. It runs within the parent VM context. The first required child method that must be called is the component SetServices() method. The child VM is created and started up before the user-written routine, specified in the SetServices() argument list, is entered.

In addition to resource description and management, the VM class offers the lowest level of ESMF communication methods. The VM communication calls are very similar to MPI. Data references in VM communication calls must be provided as raw, language specific, one-dimensional, contiguous data arrays. The similarity between VM and MPI communication calls is striking and there are many equivalent point-to-point and collective communication calls. However, unlike MPI, the VM communication calls support communication between threaded PETs in a completely transparent fashion.
