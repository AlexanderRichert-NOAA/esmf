% $Id: Grid_desc.tex,v 1.6 2007/05/16 21:58:08 cdeluca Exp $
%
% Earth System Modeling Framework
% Copyright 2002-2008, University Corporation for Atmospheric Research, 
% Massachusetts Institute of Technology, Geophysical Fluid Dynamics 
% Laboratory, University of Michigan, National Centers for Environmental 
% Prediction, Los Alamos National Laboratory, Argonne National Laboratory, 
% NASA Goddard Space Flight Center.
% Licensed under the University of Illinois-NCSA License.

The ESMF Grid class is used to describe the geometry and discretization
of a structured physical grid.  It also contains the description of the
grid's underlying topology and the decomposition of the physical grid
across the available computational resources.  The most frequent 
use of the Grid class is to describe physical grids in user
code so that sufficient information is available to ESMF methods
such as regridding. 

\begin{center}
\begin{tabular}{|p{6in}|}
\hline
\vspace{.01in}
{\bf Key Features} \\[.01in]
Representation of structured grids, including uniform and
rectilinear grids (e.g. lat-lon grids), curvilinear grids (e.g. displaced pole grids), 
and grids formed by connected logically rectangular regions (e.g. cubed
sphere grids).\\
Support for 2D, 3D, and higher dimension grids.\\ 
Distribution of grids across computational resources for parallel
operations -  users set which grid dimensions are distributed.\\
Options for users to define grid coordinates themselves or call
prefabricated coordinate generation routines for common grids.\\
Options for one-shot or incremental construction of grids.\\
Options for using a set of pre-defined stagger locations or for setting
custom stagger locations.\\[.03in] \hline
\end{tabular}
\end{center}

\subsubsection{Supported Grids}

The Grid class can represent, via the ESMF\_DistGrid class, complex connections such 
as those used in the tripole and cube-sphere grids.   It can represent grid mosaics
containing multiple logically rectangular
tiles. These tiles can be connected in a variety of ways to create a complex index space topology. Each tile of the topology can contain arbitrary coordinates. This allows the class to represent a large range of multipatch curvilinear grids. We have followed as closely as possible the description of V. Balaji in the Oct. 2006 report ``A Standard Description of Grids Used in Earth System Models.'' 
Define uniform, rectilinear, curvilinear.  

\subsubsection{Grid Composition}
\label{sec:gridcomp}

An ESMF Grid is constructed of a hierarchy of elements. At the top
level a grid is constructed of a set of {\bf Tiles}. Each tile is a logically
rectangular distributed index space. A tile will usually have some
physical significanc (e.g. the face of a cube). The piece of a tile
which resides on one DE is called a {\bf LocalTile}. For example, the six
faces of a cubed sphere Grid are each tiles and each of 
the tiles/faces can be divided into many LocalTiles by its
distribution across DEs. 

\subsubsection{Options for Grid Creation} 

The Grid class is constructed using a layered approach to allow the 
users to select the level of control they want in interacting with
the Grid interface. At the highest level are the Grid Generation interfaces. 
These create a specific grid shape and fill in the appropriate coordinates. 
These will be implemented during a later phase of development. The
next level down are the specific shape grid creation interfaces (See Section~\textbf{Need Ref}). 
These allow the user to create a grid with a specific topology and 
distribution, but empty coordinate arrays. The lowest level are
the general grid creation interfaces (See Section~\textbf{Need Ref}). These allow the user
complete control over the description of their grids, but
make no assumptions about a specific topology or distribution. 

\subsubsection{Deferred Grid Creation}
 With a more complex interface such as that for Grid creation
for clarity's sake it is often useful to be able to proceed in stages
(e.g. setting various properties in understandable chunks). The 
Grid class provides the facility to do this using a set/commit paradigm.
This capability is also useful in distributing a grid object before
initialization or when multiple components contribute to the 
definition of a grid. Section~\ref{sec:usage:setcommit}
contains a description and example of this interface. 

\begin{tabular}{|p{2.5in}|p{1.5in}|p{1.5in}|p{1.5in}|}
\hline
\multicolumn{4}|c|{\bf Options for Grid Creation} \\[.01in]
\hline
Command sequence & Missing & Function & Status \\ 
\hline
{\tt ESMF\_GridCreateEmpty()} 
& topology information and coordinates, other options undefined
& allocated placeholder that can be filled in
& ESMF\_GRIDSTATUS\_NOT\_READY \\
\hline
{\tt ESMF\_GridCreate()}\newline
or \newline
{\tt ESMF\_GridCreateEmpty()}\newline
{\tt ESMF\_GridSet()}\newline
{\tt ESMF\_GridSet()}\newline
...\newline
{\tt ESMF\_GridCommit(ESMF\_GRIDSTATUS\_FIELD\_READY)}\newline
or shortcut method, e.g. \newline
{\tt ESMF\_GridCreateLatLonSphere()}\newline
{\tt ESMF\_GridCreateLatLonRect()}
& coordinates
& can be used as the basis for Field allocation
& ESMF\_GRIDSTATUS\_FIELD\_READY\\
\hline
{\tt ESMF\_GridCreate()}\newline
{\tt ESMF\_GridSetCoordFromArray()}\newline
{\tt ESMF\_GridCommit(ESMF\_GRIDSTATUS\_REGRID\_READY)}\newline
or \newline 
{\tt ESMF\_GridCreate()}\newline
{\tt ESMF\_GridGetLocalTile(localTile)}\newline
... user fills in localTile coordinate values
{\tt ESMF\_GridCommit(ESMF\_GRIDSTATUS\_REGRID\_READY)}\newline
or \newline
{\tt ESMF\_GridCreateLatLonSphere()}\newline
{\tt ESMF\_GridSetCoordLatLonSphere()}\newline
{\tt ESMF\_GridCommit(ESMF\_GRIDSTATUS\_REGRID\_READY)}
& nothing; Grid is complete
& can be used in regrid methods
& ESMF\_GRIDSTATUS\_FIELD\_READY\\
\hline
\end{tabular}


\subsubsection{Factorized Coordinate Storage}

Often the coordinates for a grid do not vary across the entire
index space. For example, in a 2D rectilinear grid for a fixed y
inddex the y coordinate value will not change as x index changes,
and for a fixed x index the x coordinate value will not change as the
y index changes. In cases such as this the entire range of 
coordinates does not need to be stored, instead a reduced
(factorized) set of coordinate arrays can be stored which 
still describe the coordinates for the full grid, but at a large reduction in 
memory. Please see Section~\ref{sec:usage:coordstore} for
description and examples of the use of factorized coordinate
storage in ESMF Grids. 

\subsubsection{Staggering}

 A useful finite difference technique is to place different physical
quantities at different locations within a grid cell. This {\bf staggering}
of the physical variables on the mesh is introduced so that the difference
of a field is naturally defined at the location of another variable. When creating an 
ESMF Grid the user specifies which stagger locations the grid should 
contain (default is only the cell center).  Staggers can be set for up to the 
maximum grid dimension.  Later, when creating an  ESMF\_Field on the Grid the user
will specify upon which stagger location the Field and their data will reside.

There are predefined staggers and predefined stagger locations for ease of use,
however, the user can also specify their own if they need something different 
(see Section~\ref{ref:stagger} for a more in depth discussion of staggers).
 
For examples and a full description of the stagger interface 
please see Section~\ref{sec:usage:staggerloc}. 

To add:

{\bf Treatment of global and global data}{br}
 


