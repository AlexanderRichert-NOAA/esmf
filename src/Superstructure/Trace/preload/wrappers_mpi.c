
/**
 *  wrappers_mpi.c
 *
 *  !! DO NOT EDIT !!
 *  This file was generated by gen_wrappers_mpi.py.
 *  !! DO NOT EDIT !!
 *
 *  Wrappers for MPI calls so we can trace them.
 *  These are linked statically into the executable using
 *  --wrap=SYMBOL flags to the linker.
 *
 */

#ifndef ESMF_MPIUNI

#include <mpi.h>

#include "ESMCI_Macros.h"
#include "ESMCI_Trace.h"
#include "preload.h"

extern "C" {

  static int insideMPIRegion = 0;
  
  /*
   * C MPI functions
   */

  
    extern int __real_MPI_Allreduce(const void *sendbuf, void *recvbuf, int count, MPI_Datatype datatype, MPI_Op op, MPI_Comm comm);    

    int __wrap_MPI_Allreduce(const void *sendbuf, void *recvbuf, int count, MPI_Datatype datatype, MPI_Op op, MPI_Comm comm) {
      if (c_esmftrace_isinitialized() == 1 && insideMPIRegion == 0) {
        //printf("__wrap_MPI_Allreduce (C)\n");
        insideMPIRegion = 1;
        ESMCI::TraceMPIWaitStart();
        int ret = __real_MPI_Allreduce(sendbuf, recvbuf, count, datatype, op, comm);
        ESMCI::TraceMPIWaitEnd();
        insideMPIRegion = 0;
        return ret;
      }
      else {
        return __real_MPI_Allreduce(sendbuf, recvbuf, count, datatype, op, comm);
      }
    }
  
    extern int __real_MPI_Barrier(MPI_Comm comm);    

    int __wrap_MPI_Barrier(MPI_Comm comm) {
      if (c_esmftrace_isinitialized() == 1 && insideMPIRegion == 0) {
        //printf("__wrap_MPI_Barrier (C)\n");
        insideMPIRegion = 1;
        ESMCI::TraceMPIWaitStart();
        int ret = __real_MPI_Barrier(comm);
        ESMCI::TraceMPIWaitEnd();
        insideMPIRegion = 0;
        return ret;
      }
      else {
        return __real_MPI_Barrier(comm);
      }
    }
  
    extern int __real_MPI_Wait(MPI_Request *request, MPI_Status *status);    

    int __wrap_MPI_Wait(MPI_Request *request, MPI_Status *status) {
      if (c_esmftrace_isinitialized() == 1 && insideMPIRegion == 0) {
        //printf("__wrap_MPI_Wait (C)\n");
        insideMPIRegion = 1;
        ESMCI::TraceMPIWaitStart();
        int ret = __real_MPI_Wait(request, status);
        ESMCI::TraceMPIWaitEnd();
        insideMPIRegion = 0;
        return ret;
      }
      else {
        return __real_MPI_Wait(request, status);
      }
    }
  

  /*
   * Fortran MPI functions
   */

  
    extern void FTN_X(__real_mpi_allgather)(MPI_Fint *sendbuf, MPI_Fint *sendcount, MPI_Fint *sendtype, MPI_Fint *recvbuf, MPI_Fint *recvcount, MPI_Fint *recvtype, MPI_Fint *comm, MPI_Fint *ierr);    

    void FTN_X(__wrap_mpi_allgather)(MPI_Fint *sendbuf, MPI_Fint *sendcount, MPI_Fint *sendtype, MPI_Fint *recvbuf, MPI_Fint *recvcount, MPI_Fint *recvtype, MPI_Fint *comm, MPI_Fint *ierr) {
      if (c_esmftrace_isinitialized() == 1 && insideMPIRegion == 0) {
        //printf("__wrap_mpi_allgather_ (Fortran)\n");
        insideMPIRegion = 1;
        ESMCI::TraceMPIWaitStart();
        FTN_X(__real_mpi_allgather)(sendbuf, sendcount, sendtype, recvbuf, recvcount, recvtype, comm, ierr);
        ESMCI::TraceMPIWaitEnd();
        insideMPIRegion = 0;
      }
      else {
        FTN_X(__real_mpi_allgather)(sendbuf, sendcount, sendtype, recvbuf, recvcount, recvtype, comm, ierr);
      }
    }
  
    extern void FTN_X(__real_mpi_allgatherv)(MPI_Fint *sendbuf, MPI_Fint *sendcount, MPI_Fint *sendtype, MPI_Fint *recvbuf, MPI_Fint *recvcount, MPI_Fint *displs, MPI_Fint *recvtype, MPI_Fint *comm, MPI_Fint *ierr);    

    void FTN_X(__wrap_mpi_allgatherv)(MPI_Fint *sendbuf, MPI_Fint *sendcount, MPI_Fint *sendtype, MPI_Fint *recvbuf, MPI_Fint *recvcount, MPI_Fint *displs, MPI_Fint *recvtype, MPI_Fint *comm, MPI_Fint *ierr) {
      if (c_esmftrace_isinitialized() == 1 && insideMPIRegion == 0) {
        //printf("__wrap_mpi_allgatherv_ (Fortran)\n");
        insideMPIRegion = 1;
        ESMCI::TraceMPIWaitStart();
        FTN_X(__real_mpi_allgatherv)(sendbuf, sendcount, sendtype, recvbuf, recvcount, displs, recvtype, comm, ierr);
        ESMCI::TraceMPIWaitEnd();
        insideMPIRegion = 0;
      }
      else {
        FTN_X(__real_mpi_allgatherv)(sendbuf, sendcount, sendtype, recvbuf, recvcount, displs, recvtype, comm, ierr);
      }
    }
  
    extern void FTN_X(__real_mpi_allreduce)(MPI_Fint *sendbuf, MPI_Fint *recvbuf, MPI_Fint *count, MPI_Fint *datatype, MPI_Fint *op, MPI_Fint *comm, MPI_Fint *ierr);    

    void FTN_X(__wrap_mpi_allreduce)(MPI_Fint *sendbuf, MPI_Fint *recvbuf, MPI_Fint *count, MPI_Fint *datatype, MPI_Fint *op, MPI_Fint *comm, MPI_Fint *ierr) {
      if (c_esmftrace_isinitialized() == 1 && insideMPIRegion == 0) {
        //printf("__wrap_mpi_allreduce_ (Fortran)\n");
        insideMPIRegion = 1;
        ESMCI::TraceMPIWaitStart();
        FTN_X(__real_mpi_allreduce)(sendbuf, recvbuf, count, datatype, op, comm, ierr);
        ESMCI::TraceMPIWaitEnd();
        insideMPIRegion = 0;
      }
      else {
        FTN_X(__real_mpi_allreduce)(sendbuf, recvbuf, count, datatype, op, comm, ierr);
      }
    }
  
    extern void FTN_X(__real_mpi_barrier)(MPI_Fint *comm, MPI_Fint *ierr);    

    void FTN_X(__wrap_mpi_barrier)(MPI_Fint *comm, MPI_Fint *ierr) {
      if (c_esmftrace_isinitialized() == 1 && insideMPIRegion == 0) {
        //printf("__wrap_mpi_barrier_ (Fortran)\n");
        insideMPIRegion = 1;
        ESMCI::TraceMPIWaitStart();
        FTN_X(__real_mpi_barrier)(comm, ierr);
        ESMCI::TraceMPIWaitEnd();
        insideMPIRegion = 0;
      }
      else {
        FTN_X(__real_mpi_barrier)(comm, ierr);
      }
    }
  
    extern void FTN_X(__real_mpi_wait)(MPI_Fint *request, MPI_Fint *status, MPI_Fint *ierr);    

    void FTN_X(__wrap_mpi_wait)(MPI_Fint *request, MPI_Fint *status, MPI_Fint *ierr) {
      if (c_esmftrace_isinitialized() == 1 && insideMPIRegion == 0) {
        //printf("__wrap_mpi_wait_ (Fortran)\n");
        insideMPIRegion = 1;
        ESMCI::TraceMPIWaitStart();
        FTN_X(__real_mpi_wait)(request, status, ierr);
        ESMCI::TraceMPIWaitEnd();
        insideMPIRegion = 0;
      }
      else {
        FTN_X(__real_mpi_wait)(request, status, ierr);
      }
    }
  

}

#endif
