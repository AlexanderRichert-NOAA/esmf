% $Id: Coupler_req.tex,v 1.3 2007/06/22 23:21:44 cdeluca Exp $

\req{Components}
\label{req:compall}

\sreq{Component names}
Each component shall be associated with a name.  If a name is not
supplied by the user at creation, one will be assigned by default.  
User-defined component names shall not conflict with names reserved for ESMF 
generic components.     
\begin{reqlist}
{\bf Priority:} 1\\
{\bf Source:} Required by NSIPP, MIT, CCSM-CPL, GFDL \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. 
\end{reqlist}

\sreq{Creation}

\ssreq{Standard creation} 
It shall be possible to create a component based on a PE list or 
layout, and a set of other arguments that are optional or component specific. 
\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:} Required by NSIPP, MIT, CCSM-CPL, GFDL  \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit testing.
{\bf Notes:} This implies that all components, including couplers and
application components, are distributed.
\end{reqlist}

\ssreq{Creation based on replication}
It shall be possible to create a component by specifying an 
existing component to be replicated, an optional name, and an 
optional PE list or layout.  If no PE list or layout is supplied 
one from the component being replicated shall be used.  Another
way of stating this requirement is that it must be possible to 
create any number of instances of a component.
\begin{reqlist}
{\bf Priority:} 1\\
{\bf Source:} Required by NSIPP, MIT, GFDL \\
{\bf Status:} Approved-2.\\
{\bf Verification:} Unit testing.\\
{\bf Notes:} A typical use would be to perform an ensemble of 
integrations within a single application.  This is required by 
applications that have tight coupling between ensemble members, 
such as ensemble Kalman Filter.
\end{reqlist}

\ssreq{Creation of subcomponents}
It shall be possible for a component to create a subcomponent 
using the component creation methods above.  The subcomponent 
must be defined on a PE list or layout that is entirely contained 
within that of the component that creates it.
\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:} Required by NSIPP, MMIT, GFDL\\
{\bf Status:} Approved-1.\\
{\bf Verification:} Unit test.
\end{reqlist}

\sreq{Deletion}
A component may be deleted, in which case it is expected to delete
its subcomponents before deleting itself.  The component shall free
its resources, including its PEs and any memory that it has allocated. 
\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:} Required by NSIPP, MIT, GFDL.\\
{\bf Status:} Approved-1.\\
{\bf Verification:} Unit test.
\end{reqlist}

\sreq{Interaction with subcomponents}
A component shall be able to call any public method of its 
subcomponents.  A component is responsible for coordinating
the execution of its subcomponents, for example by ensuring
that they are properly initialized, run and halted.
\begin{reqlist}
{\bf Priority:} 2 \\
{\bf Source:} NSIPP, MIT, GFDL \\
{\bf Status:} Approved-1.\\
{\bf Verification:} Code inspection. \\
\end{reqlist}

\sreq{SPMD components}
A component may be instantiated as a single executable.
\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:} CCSM-CPL, POP, CICE, PSAS, MIT, GFDL, NSIPP \\
{\bf Status:} Approved-1.\\
{\bf Verification:} Code inspection. \\
\end{reqlist}

\sreq{MPMD components}
It shall be possible to define a component instantiated as
multiple executables.
\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:} CCSM-CPL, POP, CICE, PSAS , MIT, GFDL \\
{\bf Status:} Approved-1.\\
{\bf Verification:} Code inspection. \\
{\bf Notes:} We may want to restrict this to application components.
\end{reqlist}

\sreq{Serial execution}
It shall be possible for a component to schedule its subcomponents 
for serial execution. \\
\begin{reqlist}
{\bf Priority:} 1 \\ 
{\bf Source:}  CCSM-CPL, POP, CICE, PSAS, MIT, GFDL \\
{\bf Status:} Approved-1. \\
{\bf Verification:} System test.
{\bf Notes:} overlap with Components.
\end{reqlist}

\sreq{Concurrent execution}
It shall be possible for a component to schedule its subcomponents 
for concurrent execution.
\begin{reqlist}
{\bf Priority:}  1 \\ 
{\bf Source:}  CCSM-CPL, POP, CICE, PSAS, MIT, GFDL \\
{\bf Status:} Approved-1. \\
{\bf Verification:} 
{\bf Notes:} overlap with Components.
\end{reqlist}

\sreq{Components within address space}
A component shall be able to exchange data with components that share 
its address space.
\begin{reqlist}
{\bf Priority:} 1 \\ 
{\bf Source:}  CCSM-CPL, POP, CICE, MIT, GFDL \\
{\bf Status:} Approved-1. \\
{\bf Verification:} System test.
\end{reqlist}

\sreq{Components outside address space}
A component shall be able to exchange data with components that do
not share its address space.
\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:}  CCSM-CPL, POP, CICE, PSAS, MIT, GFDL \\
{\bf Status:} Approved-1. \\
{\bf Verification:} System test. \\ 
{\bf Notes:}  This could be done using MPI based messaging or native
  API's that are optimal for a given platform. It should be possible
  for the application to make smart decisions about what to use.
\end{reqlist}

\sreq{Unexpected termination}
Whenever possible, a component should attempt a graceful exit
(e.g checkpointing of all ``live'' components that it contains) 
when it undergoes unscheduled termination.
\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:}  CCSM-CPL (desired), POP, CICE, PSAS, MIT, GFDL \\
{\bf Status:} Approved-1. \\
{\bf Verification:} System test.
\end{reqlist}

\sreq{Cross-component signals}

Signalling is used for events that may occur within a component at
unscheduled, or unpredictable intervals. Scheduled events have already
been dealt with in the cross-component requirements of
\textbf{TM:Alarm}. Components should be able to issue and trap signals.

\ssreq{Checkpoint request}
It shall be possible to send a signal to a component asking it to
halt.
\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:}  CCSM-CPL, PSAS, MIT, GFDL \\
{\bf Status:} Approved-1. \\
{\bf Verification:} System test.
\end{reqlist}

\ssreq{Data request}
It shall be possible to send a signal to a component asking for data
at a specified time instant.
\begin{reqlist}
{\bf Priority:} 2\\
{\bf Source:}  CCSM-CPL, PSAS, MIT, GFDL \\
{\bf Status:} Approved-2. \\
{\bf Verification:} System test.
\end{reqlist}

\sreq{Operations}

\ssreq{Initialize}
A component shall have a method that initializes its internal values.
\begin{reqlist}
{\bf Priority:} 1\\
{\bf Source:} Required by NSIPP, MIT, CCSM-CPL, GFDL. \\
{\bf Status:} Approved-1.\\
{\bf Verification:} System test.
\end{reqlist}

\ssreq{Run}
A component shall have a run method that initiates its execution and
allows the user to specify the running interval. 
\begin{reqlist}
{\bf Priority:} 1\\
{\bf Source:} Required by NSIPP, MIT, CCSM-CPL, GFDL. \\
{\bf Status:} Approved-1.\\
{\bf Verification:} System test.
\end{reqlist}

\ssreq{Write and restore from restart}
A component shall be able to write its restart state and be able 
to reconstruct itself identically based on that state.  The PE list 
or layout may be different than the component's original configuration.  
\begin{reqlist}
{\bf Priority:} 1\\
{\bf Source:} NSIPP, CCSM-CPL, MIT, GFDL, POP, CICE, MIT \\
{\bf Status:} Approved-1.\\
{\bf Verification:} System test. \\
\end{reqlist}

\ssreq{Prepare output exchange packets}
A component shall provide a method that prepares an output exchange packet
based on selections from its export state.
\begin{reqlist}
{\bf Priority:} 1\\
{\bf Source:} Required by MIT, CCSM-CPL, NSIPP, GFDL. \\
{\bf Status:} Approved-1.\\
{\bf Verification:} System test.
\end{reqlist}

\ssreq{Accept input exchange packets}
A component shall provide a method that accepts an input exchange packet
in conformance with its import state.
\begin{reqlist}
{\bf Priority:} 1\\
{\bf Source:} MIT, CCSM-CPL, NSIPP, GFDL \\
{\bf Status:} Approved-1.\\
{\bf Verification:} System test.
\end{reqlist}

\sreq{Queries}

\ssreq{Query name}
A component shall be able to return its name.
\begin{reqlist}
{\bf Priority:} 1\\
{\bf Source:} MIT, GFDL \\
{\bf Status:} Approved-1.\\
{\bf Verification:}  
\end{reqlist}

\ssreq{Query layout}
A component shall be able to return the layout over which it is 
distributed, including its PE list and its communication and data 
sharing mechanisms.
\begin{reqlist}
{\bf Priority:} 1\\
{\bf Source:} CCSM-CPL, PSAS, MIT, GFDL \\
{\bf Status:} Approved-1.\\
{\bf Verification:}
{\bf Notes:}  Whether or not the following are in use and
how they are each bound to PEs may be queried, e.g MPI processes, 
concurrent Unix processes, concurrent OpenMP threads, concurrent 
Posix threads.
\end{reqlist}

\ssreq{Query run status}

Components shall be able to return its status:
initialized, or in an error condition.

\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:} NSIPP, MIT, GFDL \\
{\bf Status:} Approved-1.\\
{\bf Verification:}  
{\bf Notes:} additional status fields could include: running, waiting for data,
etc.
\end{reqlist}

\ssreq{Query subcomponent layout}
A component shall be able to return the layouts of 
its subcomponents. 
\begin{reqlist}
{\bf Priority:} 3 \\
{\bf Source:} MIT, GFDL \\
{\bf Status:} Proposed. \\
{\bf Verification:} 
\end{reqlist}

\ssreq{Query import state}
A component shall be able to return a list and description of the
data, such as field names and descriptions, that it requires as input
in order to run.  This shall be provided in a standard format.

\begin{reqlist}
{\bf Priority:} 1\\
{\bf Source:} NSIPP, MIT, CCSM-CPL, POP, CICE, GFDL \\
{\bf Status:} Approved-1.\\
{\bf Verification:}  
{\bf Notes:} ESMF shall not impose a naming convention. These are
being developed elsewhere (e.g \htmladdnormallinkfoot{as part of the
  CF metadata convention}{http://www.cgd.ucar.edu/cms/eaton/netcdf/standard\_name\_20010305.html}.)
\end{reqlist}

\ssreq{Query export state}
A component shall be able to return a list and description of the 
data that it can make available to other components.  This shall be
provided in a standard format.
\begin{reqlist}
{\bf Priority:} 1\\
{\bf Source:} NSIPP, MIT, CCSM-CPL, POP, CICE, GFDL \\
{\bf Status:} Approved-1.\\
{\bf Verification:} 
\end{reqlist}

\ssreq{Query state summary}

Each component shall be able to return a ``state summary'' that may
include e.g run status (e.g. whether the component has been
initialized), the size of its restart state, if initialized,
appropriate verification checksums, and any control parameters that
the component deems ``application-settable.''
\begin{reqlist}
{\bf Priority:} 2\\
{\bf Source:} NSIPP \\
{\bf Status:} Approved-2.\\
{\bf Verification:} 
\end{reqlist}

\sreq{Query exchange packets}
Given the name of an exchange packet, a component shall return 
a reference to that exchange packet.  A component may have 
multiple exchange packets defined.
\begin{reqlist}
{\bf Priority:} 3\\
{\bf Source:} Desired by MIT \\
{\bf Status:} Proposed. \\
{\bf Verification:} 
\end{reqlist}

\ssreq{Query input datasets}
A component shall be able to return a list of any input 
data files necessary for it to run.  If this information is not
available it shall relay a message to that effect to the user.
\begin{reqlist}
{\bf Priority:} 3\\
{\bf Source:} MIT \\
{\bf Status:} Proposed.\\
{\bf Verification:} 
\end{reqlist}

\ssreq{Query compute parameters}
Insofar as it is possible, a component shall be able to return 
a description of the computing environment in which it is being run, 
including computing architecture and compiler name and version, 
compile options, and numerical precision.  
\begin{reqlist}
{\bf Priority:} 3\\
{\bf Source:} MIT \\
{\bf Status:} Proposed.\\
{\bf Verification:} \\ 
{\bf Notes:} This requirement may be extended and further detailed
in the parameter specification requirements document.
\end{reqlist}

\ssreq{Consolidated query responses}
A component shall be able to direct queries to its subcomponents
and return consolidated replies.  For example,
a component shall be able to return a list of the names of all the
subcomponents that it contains, a list of subcomponent layouts,
and an overall run status based on the individual run statuses of 
its subcomponents.
\begin{reqlist}
{\bf Priority:} 3\\
{\bf Source:} MIT, GFDL \\
{\bf Status:} Approved-2.\\
{\bf Verification:} 
\end{reqlist}

\req{Application components}

In addition to the general requirements for a component described in 
\ref{req:compall}, application components are required to provide the
following capabilities.

\sreq{Application initialize operation}
An application shall provide a method that allocates and initializes 
resources, such as underlying libraries and any global variables or 
buffer space, necessary to run an ESMF application.
\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:} MIT, DAO, GFDL \\
{\bf Status:} Approved-1.\\
{\bf Verification:}  
\end{reqlist}

\sreq{Optimized compute resource bindings}

An application component shall be able to control the binding of both its own
tasks and its subcomponents' tasks to compute resources, so that the resulting
sets of tasks are aligned efficiently on compute resources.

\begin{reqlist}
{\bf Priority:} 2 \\
{\bf Source:}  CCSM-CPL (desired), MIT, GFDL, NSIPP \\
{\bf Status:} Approved-1. \\
{\bf Verification:} System test.\\
{\bf Notes:}  We want to have the application component task for a particular
  spatial interngrid region aligned with the physical model components and
  coupler components that operate on that region.  Binding
  encompasses both associating tasks with specific PE lists and
  creating the necessary communication substrate to connect tasks that
  need to communicate.  This involves interactions with distributed
  interngrid and communication kernel elements.
\end{reqlist}

\sreq{Application component as main}
An application component may constitute the main program invoked by each
executable participating in an ESMF application.
\begin{reqlist}
{\bf Priority:} 1\\
{\bf Source:} CCSM-CPL, POP, CICE, PSAS, MIT, GFDL \\
{\bf Status:} Approved-1 \\
{\bf Verification:} System test.
{\bf Notes:}  This is still a little weird.  It distorts the notion of a
component somewhat.  -- CMD.
\end{reqlist}

\sreq{Application component as subroutine}
An application component may be invoked by executables
participating in an ESMF application, which have their own main program.
\begin{reqlist}
{\bf Priority:} 1\\
{\bf Source:} CCSM-CPL, POP, CICE, PSAS, MIT, GFDL \\
{\bf Status:} Approved-1 \\
{\bf Verification:} System test.
\end{reqlist}

\sreq{Advance by timestep} It shall be possible to direct components to
advance to application control after a specific number of steps.
\begin{reqlist}
{\bf Priority:} 2\\
{\bf Source:}  CCSM-CPL, PSAS, MIT, GFDL(some codes) \\
{\bf Status:} Approved-2. \\
{\bf Verification:} System test.\\ 
{\bf Notes:} Not all components may support this option.
\end{reqlist}

\sreq{Advance by time} It shall be possible to direct components to return to
application control at a specified time instant.
\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:}  CCSM-CPL, POP, CICE, PSAS, MIT, GFDL \\
{\bf Status:} Approved-1\\
{\bf Verification:} System test.\\
{\bf Notes:} Not all components may support this option.
\end{reqlist}

\ssreq{Advance by alarm} 
It shall be possible to direct components to return to application
control at a specified alarm event.
\begin{reqlist}
{\bf Priority:} 2 \\
{\bf Source:}  CCSM-CPL, POP, CICE, PSAS, MIT \\
{\bf Status:} Approved-2. \\
{\bf Verification:} System test.
\end{reqlist}

\sreq{Exchange scheduling}
It shall be possible for two components to schedule data exchanges at
regular intervals.

\begin{reqlist}
{\bf Priority:} 1 \\ 
{\bf Source:}  CCSM-CPL, POP, CICE, PSAS, MIT, GFDL \\
{\bf Status:} Approved-1. \\
{\bf Verification:} System test.\\ 
{\bf Notes:}  Regularity is probably not a requirement: any semantics
  supported by \textbf{TM:Alarm} should be possible.
\end{reqlist}

\sreq{Coupling timestep}
The application component shall not impose restrictions on the
coupling timestep method.  
\begin{reqlist}
{\bf Priority:}  1 \\ 
{\bf Source:}  CCSM-CPL, POP, CICE, PSAS, MIT, GFDL \\
{\bf Status:} Approved-1. \\
{\bf Verification:} System test. \\ 
{\bf Notes:} E.g., timestep may be \emph{forward} in time,
\emph{backward} in time, \emph{forward-backward} in time.  Data exchanges may be
explicit or implicit (i.e., communication would include the implicit sensitivity 
terms that occur, for example, in a tridiagonal solver).
\end{reqlist}

\sreq{Queries}

\ssreq{Query case name}
An application shall return its case name, the user-specified name for 
a particular run.  If no case name is specified a default will 
be assigned.
\begin{reqlist}
{\bf Priority:} 3 \\
{\bf Source:} MIT, DAO \\
{\bf Status:} Proposed.\\
{\bf Verification:} System test. 
\end{reqlist}

\ssreq{Query case date}
An application shall return the real-world date at which its execution
began.
\begin{reqlist}
{\bf Priority:} 3\\
{\bf Source:} MIT \\
{\bf Status:} Proposed.\\
{\bf Verification:} System test.
\end{reqlist}

\sreq{Global PE list}
It shall be possible to retrieve the global list of PEs participating 
in an application.
\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:}  CCSM-CPL, POP, CICE, PSAS, MIT, GFDL \\
{\bf Status:} Approved-1. \\
{\bf Verification:} System test. \\ 
{\bf Notes:}  Does this grow as MPMD executables check in? Can control
  retain control of these PEs if MPMD executables check out?
\end{reqlist}

\sreq{Scalability}
Application components shall be scalable.

\begin{reqlist}
{\bf Priority:} 1 \\ 
{\bf Source:}  CCSM-CPL, POP, CICE, PSAS (desired), MIT, GFDL \\
{\bf Status:} Approved-1. \\
{\bf Verification:} System test.\\ 
{\bf Notes:}  The control mechanism should not be a sequential bottleneck.
\end{reqlist}

\req{InternGridded components}

In addition to the general requirements for  a component described in 
\ref{req:compall}, interngridded components are required to provide the
following capabilities.

\sreq{InternGridded components have one or more associated interngrids}
A interngridded component shall be associated with one or more interngrids.
A default interngrid shall be associated with 
each interngridded component and shall default to the first interngrid created 
in the component.  The default interngrid may be assigned.
\begin{reqlist}
{\bf Priority:} 1\\
{\bf Source:} NSIPP, GFDL, MIT \\
{\bf Status:} Approved-1.\\
{\bf Verification:} 
\end{reqlist}

\sreq{Creation}
The creation method of a interngridded component shall require as an 
argument either a fully created interngrid or the parameters
required to create a interngrid.
\begin{reqlist}
{\bf Priority:} 1\\
{\bf Source:} Required by NSIPP, MIT, CCSM-CPL, GFDL \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test.
\end{reqlist}

\sreq{Queries}

\ssreq{Query interngrids}
A interngridded component can return a list of its interngrids.
\begin{reqlist}
{\bf Priority:} 3\\
{\bf Source:} \\
{\bf Status:} Proposed. \\
{\bf Verification:} Unit test.
\end{reqlist}

\ssreq{Query default interngrid}
A interngridded component can return its default interngrid.
\begin{reqlist}
{\bf Priority:} 2\\
{\bf Source:} GFDL, MIT\\
{\bf Status:} Approved-2.\\
{\bf Verification:} Unit test.
\end{reqlist}

\req{Coupler components}

In addition to the general requirements for a component described in 
\ref{req:compall}, coupler components are required to provide the
following capabilities.

\sreq{Coupler run operation}
A coupler component shall provide a run method in which the data in the
export state of a source component is transformed and 
transferred to a destination component where it is transformed 
into the destination component's import state.  This operation 
may occur at a given event or a set interval.  Transforms may be 
user-defined, generic, or null, and multiple transforms may be applied 
in succession.
\begin{reqlist}
{\bf Priority:} 1\\ 
{\bf Source:} NSIPP, MIT, GFDL \\
{\bf Status:} Approved-1.\\
{\bf Verification:} System test.
\end{reqlist}

\ssreq{Coupling operation limited to two components}
A single coupling operation shall be limited to data transformation and
transfer between two components.
\begin{reqlist}
{\bf Priority:} \\ 
{\bf Source:} NSIPP \\
{\bf Status:} Rejected.\\
{\bf Verification:} \\
{\bf Notes:} We need to define coupling between more than two 
components, for example when broadcasting values to ensembles,
generating ensemble means, or merging the spans of multiple components
to interface with another whose span is their union (e.g. 
combining ocean and land to form a complete interface with the 
atmosphere).
\end{reqlist}

\ssreq{Unlimited number of coupling operations}
No limit is placed on the number of coupling operations defined or
executed between a pair of component or in an application overall, 
other than computing resources.
\begin{reqlist}
{\bf Priority:} 1\\ 
{\bf Source:} MIT, GFDL \\
{\bf Status:} Approved-1.\\
{\bf Verification:} Unit test.\\
\end{reqlist}

\req{General computational requirements}

\sreq{Validity checking}
Methods shall be provided to check the validity of components and 
coupling operations and report inconsistencies or errors.
\begin{reqlist}
{\bf Priority:} 2\\ 
{\bf Source:} NSIPP \\
{\bf Status:} Approved-2.\\
{\bf Verification:} System test.
\end{reqlist}
\req{Syntax}

\sreq{Common syntax across platforms}
The control syntax should be the same on all platforms.
\begin{reqlist}
{\bf Priority:} 1\\
{\bf Source:}  CCSM-CPL, PSAS, MIT, GFDL \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Code inspection.
\end{reqlist}

\sreq{Performance}
The control mechanism should be compatible with 100msec 
component cycling times.
\begin{reqlist}
{\bf Priority:} 2\\
{\bf Source:}  MIT \\
{\bf Status:} Approved-2. \\
{\bf Verification:} System test.
\end{reqlist}

\sreq{Compute overhead}
The component interface mechanisms need to be compatible with
operation frequency as high as ten times per second (i.e. the period
during which no component is in an interface phase may be
as short as 100msec). 
\begin{reqlist}
{\bf Priority:} 3 \\ 
{\bf Source:} MIT \\
{\bf Status:} Proposed.\\
{\bf Verification:} System test.
\end{reqlist}








