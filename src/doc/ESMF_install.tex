% $Id: ESMF_install.tex,v 1.34 2003/11/12 22:09:52 svasquez Exp $

\subsection{ESMF Download Options}

Major releases of the ESMF software can be downloaded by following
the instructions on the 
the {\bf Downloads \& Documentation} page on the ESMF 
website, \htmladdnormallink{http://www.esmf.ucar.edu}{http://www.esmf.ucar.edu}.  There are two options for using the ESMF:

\begin{itemize}
\item Download a pre-built ESMF shared object library and
test applications for a particular platform.  If you choose
this approach, you can skip ahead to Section~\ref{UsingLibrary},
Using the ESMF.  
\item Download the full ESMF source code, and compile and link
the framework to any necessary system libraries.  This will
result in a shared object file (with a *.so extension)
that can be linked in with the user's code, or with the demo
{ESMF\_COUPLED\_FLOW} executable.  In this case you will need
to follow all the instructions in subsequent sections of the 
{\it Quick Start} guide, beginning with Section~\ref{InstallProcedures},
Installation.
\end{itemize}

You may find it necessary to build the ESMF yourself
if we do not offer a shared object library for the current
version of your compiler.  The compiler versions that we offer
shared objects for are noted on the download web page.

\subsection{Installation}
\label{InstallProcedures}

\input{ESMF_systemreq}

\subsubsection{ESMF Environment Variables}

Currently the ESMF\_DIR environment variable must be set on all
platforms.  ESMF\_DIR should be set to the path of the top
level ESMF directory.  

There are six other environment variables that the build system uses.
In most cases they do not have to be set by the user.  If they are not
set, then the build system will assign default values to them.  For the
current supported platforms, the default values are fine.  The other
environment variables are:
\begin{quote}
\begin{description}

  \item[ESMF\_ARCH] Value of uname -s.  For example, his will be AIX for IBM
                 RS6000's.  There should be almost no reason for the
                 user to set ESMF\_ARCH.

  \item[ESMF\_COMPILER] Variable specifying which compiler to use.  Value
                   can be default, absoft, intel, lahey or nag. 
                   If the value is default or ESMF\_COMPILER is 
                   left unset, then the default compiler 
                   will be used.  Exceptions for default values:  
                   On Linux machines the default value 
                   is lahey and on Darwin machines it is absoft.

  \item[ESMF\_PREC] Precision value of 32 or 64.  When possible the
                 default value will be 64, otherwise it will be 32.


  \item[ESMF\_SITE] Build configure file site name or the value
                 default.  If not set, then the value of default is
                 assumed.

  \item[ESMF\_COMM] Defines which MPI communications library to use.  
                   Many times a machine will come with its own MPI 
                   library and in those cases the default setting 
                   will be mpi.  Otherwise the default setting will be 
                   mpiuni so that the mpiuni library will be used.
                   Other possible settings are mpich and lam.

  \item[ESMF\_BOPT] Build option value of g (for debug) or O (for
                 Optimize).  Default value will be O.

\end{description}
\end{quote}

On Alpha machines an additional environment variable needs
to be set:

\begin{quote}
\begin{description}
  \item[ESMF\_PROJECT] Load Sharing Facility (LSF) project name
\end{description}
\end{quote}

On an Alpha machine, test and demo applications are run using 
the bsub command.  The value of ESMF\_PROJECT is used as the 
argument for bsub's -P option. The -P option assigns a job to 
a specific project.  

Environment variables must be set in the user's shell and not
inside an ESMF makefile or build system file.  Here is an example 
of setting an environment variable in tcsh and csh shells:

\begin{verbatim}
  setenv ESMF_PREC 32
\end{verbatim}

In ksh shell environment variables are set this way:

\begin{verbatim}
  export ESMF_PREC=32
\end{verbatim}

Environment variables can also be set from the gmake command line:

\begin{verbatim}
  gmake ESMF_PREC=32
\end{verbatim}

\subsubsection{Supported Platforms}
\input{user_arch.tex}

Simultaneous multiple architecture builds are supported, with
one restriction; the test cases may only be run on one platform at a time. 

\subsubsection{Building the ESMF Libraries}
\label{BuildESMF}

% GNU make requirement.  File in build/doc
\input{user_make.tex}

Build the library with the command:
\begin{verbatim}
  gmake 
\end{verbatim}
  for a debug version or
\begin{verbatim}
  gmake ESMF_BOPT=g  
\end{verbatim}
  for the debug version.


Build options that enable you to copy the library and *.mod files to
specified directories are explained in Section~\ref{BuildOptions}. 

\subsubsection{Building the ESMF Documentation}
\label{BuildDocumentation}

\noindent To build documentation:
\begin{verbatim}
  gmake pdf           ! Makes the pdf files.
  gmake html          ! Creates the html directory.
  gmake alldoc        ! Builds all the above documents.
\end{verbatim}

\noindent Documentation files will be built in the top level directory doc.

\noindent To build documentation for one module:

\noindent First change directory to the where the desired module's documentation 
resides; for example, to build the {\tt TimeMgr} documentation start
with:

\begin{verbatim}
cd $ESMF_DIR/src/Infrastructure/TimeMgr/doc
\end{verbatim}

\noindent Next issue one of the following commands:
\begin{verbatim}
  gmake pdf      ! Builds local pdf files.
  gmake html     ! Builds local html files.
  gmake alldoc   ! Builds all of the local documents.
\end{verbatim}

\noindent The output from this local documentation build is in the top 
level {\tt doc} directory, as with the previous commands.






