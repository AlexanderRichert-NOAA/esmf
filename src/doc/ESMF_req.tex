% $ Id: $

Here we describe the requirements that apply to the whole body of 
ESMF software.  We adopt the standard requirements format described in 
the \htmladdnormallink{ESMF Software Developer's Guide}{http://www.esmf.ucar.edu/esmf\_docs/dev\_guide}.  The abbreviation used to identify
these General Requirements is {\bf GR}.

\req{Computational requirements}

\sreq{Language bindings}
ESMF software shall support the following language bindings:

\ssreq{Fortran 90 interface}
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} All codes except GFDL-HIM require F90 interfaces. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection (verification
  checklist will include array dimension information and 
  optional argument handling).
\end{reqlist}

\ssreq{C++ interface}
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} GFDL-HIM. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection (verification
  checklist will include array dimension information and 
  optional argument handling).\\
{\bf Notes:} Handling of Try/Catch exception handling and 
error signal propogation over the C/C++ Fortran boundary 
will need to be addressed in the preliminary design and
implementation prototyping.
\end{reqlist}

\ssreq{C interface}
\begin{reqlist}
  {\bf Priority:} none \\
  {\bf Source:} GFDL-HIM. \\
  {\bf Status:} Rejected. \\
  {\bf Notes:} There will be a single interface serving C and C++
  applications. This C/C++ interface will be sufficient so the C only
  interface has been rejected.
\end{reqlist}

\sreq{Platforms}
The ESMF shall operate on the following platforms:

\ssreq{IBM SP}
\begin{reqlist}
{\bf Priority:} 1-approved. \\
{\bf Source:} NCAR, NCEP. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test and system test.
\end{reqlist}

\ssreq{SGI Origin}
\begin{reqlist}
{\bf Priority:} 1-approved. \\
{\bf Source:} GFDL, LANL, NCAR, DAO.  May be part of ESMF testbed system. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test and system test.
\end{reqlist}

\ssreq{Compaq ES}
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} NSIPP, DAO.  May be part of ESMF testbed system. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test and system test.
\end{reqlist}

\ssreq{PC Linux platforms (including cluster)}
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} MIT.  Required for optional cluster milestones. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test and system test.
\end{reqlist}

\ssreq{Sun-Solaris}
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} NCAR. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test and system test.
\end{reqlist}

\ssreq{Vector machines running Unix}
\begin{reqlist}
{\bf Priority:} 2. \\
{\bf Source:} NCAR. \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Unit test and system test.
\end{reqlist}

\sreq{Performance} \label{perf}
Fully compliant adoption of the framework shall not increase the execution time 
of the milestone G codes, which are maintained and developed outside the 
framework throughout the project, by more than 10\% on scalar 
architectures within their scalable range.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for Milestone G. \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Demonstrate with NCEP analysis and MITgcm ocean.
\end{reqlist}

\sreq{Precision} ESMF will provide methods for applications using
default integers and floating-point numbers at either 32-bit or 64-bit
precision.

\begin{reqlist}
  {\bf Priority:} 1. \\
  {\bf Source:} DAO, NCEP. \\
  {\bf Status:} Approved-1. \\
  {\bf Verification:} Interface inspection (verification 
  checklist will include array dimension information and
  optional argument handling) , code inspection, unit
  test, system test. \\
  {\bf Notes:}
  \begin{enumerate}
  \item While it is technically possible through overloading to allow
    argument lists to contain arbitrary combinations of 32-bit and
    64-bit quantities, this Requirement only calls for a uniform
    application-wide word length for integers and FP numbers to be
    supported.
  \item There may be individual operations within ESMF that explicitly
    call for transformations between 64-bit and 32-bit quantities.
    Those will appear as individual requirements.
  \end{enumerate}
\end{reqlist}

\sreq{Runtime configurability} The ESMF shall allow the user to set
certain application parameters at runtime.
\begin{reqlist}
{\bf Notes:} There are many runtime configurable parameters that 
need to be set for codes operating as framework components.
The sub-requiremente listed here \ref{req:gr:Configurable_decomposition} - 
\ref{req:gr:Configurable_paths_and_directories} are some, but not all of these.
\end{reqlist}

\ssreq{Configurable decomposition} ESMF shall allow domain
decomposition and assignment of domains to processors, nodes, and/or
threads to be configurable at runtime.  The choice of parallelization
mechanism (message passing/multithreading/combination) must be
configurable at runtime.
\label{req:gr:Configurable_decomposition}
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} CAM-EUL. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} System test.
\end{reqlist}

\ssreq{Configurable resolution}
ESMF shall allow model resolution to be configurable at runtime.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} all codes. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} System test.
\end{reqlist}

\ssreq{Configurable paths and directories}
ESMF shall allow input and output paths and directories to be specified
at runtime.
\label{req:gr:Configurable_paths_and_directories}
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} all codes. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} System test.
\end{reqlist}

\sreq{Bit-reproducibility}

Bitwise identical results between two runs is an important feature for
deterministic execution, as well as for debugging and maintenance.
This is not possible to enforce across platforms, at different levels
of compiler optimization, or even different versions of the same
compiler. Within these constraints, ESMF shall provide varied levels
of bit-reproducibility:

\ssreq{Parallel bit-reproducibility}

An execution mode will be provided which allows an ESMF-based model to
return bitwise identical results from the same executable at different
processor counts, or different parallelism options. This execution
mode is not subject to the performance requirement of Section~\ref{perf}.

\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} all JMC codes. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} System test.
\end{reqlist}

\ssreq{Bit-reproducibility on identical configurations}

The \emph{default} execution mode will allow an ESMF-based model to
return bitwise identical results from the same executable at the same
processor count, with the same parallelism options. This mode
\emph{is} subject to the performance requirement of
Section~\ref{perf}.

\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} all codes. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} System test.
\end{reqlist}

\ssreq{Non bit-reproducing fast option}

If a performance enhancement may be had by waiving the default
requirement above, this will be made available in a special execution
mode. In this mode, even two runs at the same processor count, with
the same parallelism options, may not return bitwise identical
results.

\begin{reqlist}
{\bf Priority:} 2. \\
{\bf Source:} NCEP, HIM. \\
{\bf Status:} Approved-2. \\
{\bf Verification:} System test.
\end{reqlist}

\sreq{Error handling}
The ESMF shall be instrumented for error handling consistly across the
framework.  The user shall receive ample information on errors including
comprehensive error logging.
\label{req:gr:error_handling}
\begin{reqlist}
  {\bf Priority:} 1. \\
  {\bf Source:} Required by all codes. \\
  {\bf Status:} Approved-1. \\
  {\bf Verification:} Interface inspection (verification
  checklist will include array dimension information and 
  optional argument handling), code inspection, unit
  test, system test.
  {\bf Notes} Components will be required to use ESMF error
handling utilities for fatal erros to be classified as 
{\it well-behaved} ESMF components.
\end{reqlist}

\sreq{Modularity}
Layers of the framework will be designed to adapt to restructuring of
other parts of the framework and user-supplied components.  For
example, the coupling layers should be able to adapt to different
implementations and data structures of component models.
A modular design and implementation approach must be used that ensures
parts of the framework are independent of one another and can be 
developed concurrently.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for interoperability Milestones I and J. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interoperability experiments and incremental
adoption demonstrations by deployment teams.
\end{reqlist}

\sreq{Extensibility} The ESMF framework will allow extensions both
for core suppport capabilities and through plug-in components.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} All codes\\
{\bf Status:} Approved-2. \\
{\bf Verification:} Milestone demonstrations of migration
of more than twelve major applications and six styles of gridding.
\end{reqlist}

\sreq{Flexibility} The ESMF framework will be flexible and will
be suited to a wide range of Earth science applications and a broad span
of target hardware.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} All codes\\
{\bf Status:} Approved-1. \\
{\bf Verification:} Milestone demonstrations of migration
of more than twelve major applications on several different
platforms covering a wide variety of science scenarios
that span research to operational forecasting.
\end{reqlist}

\sreq{Dcoumentation} An exhaustive collection of documentation
to support ongoing evolution of ESMF is required.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} All codes\\
{\bf Status:} Approved-1. \\
{\bf Verification:} Compliance with software developers guide.
{\bf Notes:} The Software Developers Guide specifies a suite of documents 
that will be produced.
\end{reqlist}

\sreq{Compatability with batch execution}
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} All codes\\
{\bf Status:} Approved-1. \\
{\bf Verification:} Milestone demonstrations.
\end{reqlist}

\sreq{Compatability with interactive execution}
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} All codes\\
{\bf Status:} Approved-1. \\
{\bf Verification:} Milestone demonstrations.
\end{reqlist}

\sreq{Compatability with ensemble methods}
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} All codes\\
{\bf Status:} Approved-1. \\
{\bf Verification:} Milestone demonstrations.
\end{reqlist}

\sreq{Compatability with multi-institution, multi-component simulations}
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} All codes\\
{\bf Status:} Approved-1. \\
{\bf Verification:} Milestone demonstrations.
\end{reqlist}

\sreq{Ease of adoption}
It must be straightforward to integrate ESMF into an application 
that is reasonably modular. Adapting an existing modular application
to use the frameworks coupling services shall require no more
than 2\% modification of the applications source code.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} GFDL, NSIPP. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Line count.
\end{reqlist}

\req{Maintenance and support requirement}
The ESMF must be maintained as a long-term commitment by at least one
institution.  This maintenance must extend beyond adaptation to the 
computational environment, and must include an ongoing research component
dedicated to increasing the performance, flexibility and functionality of
the software.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} All participants. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Publicly documented commitment, line item in 
projected budgets.
\end{reqlist}






