% $ Id: $

Here we describe the requirements that apply to the whole body of 
ESMF software.  We adopt the standard requirements format described in 
the \htmladdnormallink{ESMF Software Developer's Guide}{http://www.esmf.ucar.edu/esmf\_docs/dev\_guide}.  The abbreviation used to identify
these General Requirements is {\bf GR}.

\req{Computational Requirements}

\sreq{Language Bindings}
ESMF software shall support the following language bindings:

\ssreq{Fortran 90 Interface}
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} All codes except GFDL-HIM require F90 interfaces. \\
{\bf Status:} Proposed. \\
{\bf Verification:} Interface inspection. 
\end{reqlist}

\ssreq{C++ Interface}
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} GFDL-HIM. \\
{\bf Status:} Proposed. \\
{\bf Verification:} Interface inspection.
\end{reqlist}

\sreq{Platforms}
The ESMF shall operate on the following platforms:

\ssreq{IBM SP}
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} NCAR, NCEP. \\
{\bf Status:} Proposed. \\
{\bf Verification:} Unit test and system test.
\end{reqlist}

\ssreq{SGI Origin}
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} GFDL, LANL, NCAR, DAO.  May be part of ESMF testbed system. \\
{\bf Status:} Proposed. \\
{\bf Verification:} Unit test and system test.
\end{reqlist}

\ssreq{Compaq ES}
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} NSIPP, DAO.  May be part of ESMF testbed system. \\
{\bf Status:} Proposed. \\
{\bf Verification:} Unit test and system test.
\end{reqlist}

\ssreq{PC Linux platforms (including cluster)}
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} MIT.  Required for optional cluster milestones. \\
{\bf Status:} Proposed. \\
{\bf Verification:} Unit test and system test.
\end{reqlist}

\ssreq{Sun-Solaris}
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} NCAR. \\
{\bf Status:} Proposed. \\
{\bf Verification:} Unit test and system test.
\end{reqlist}

\ssreq{Vector machines running Unix}
\begin{reqlist}
  {\bf Priority:} 3.
\end{reqlist}

\sreq{Performance} \label{perf}
The framework shall not increase the execution time of an existing code 
written without the framework by more than 10\% on scalar 
architectures within their scalable range.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for Milestone G. \\
{\bf Status:} Proposed. \\
{\bf Verification:} Demonstrate with NCEP analysis and MITgcm ocean.
\end{reqlist}

\sreq{Runtime Configurability} The ESMF shall allow the user to set
certain application parameters at runtime.

\ssreq{Configurable Decomposition} ESMF shall allow domain
decomposition and assignment of domains to processors, nodes, and/or
threads to be configurable at runtime.  The choice of parallelization
mechanism (message passing/multithreading/combination) must be
configurable at runtime.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} CAM-EUL. \\
{\bf Status:} Proposed. \\
{\bf Verification:} System test.
\end{reqlist}

\ssreq{Configurable Resolution}
ESMF shall allow model resolution to be configurable at runtime.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} all codes. \\
{\bf Status:} Proposed. \\
{\bf Verification:} System test.
\end{reqlist}

\sreq{Bit-reproducibility}

Bitwise identical results between two runs is an important feature for
debugging and maintenance. This is not possible to ensure across
platforms, at different levels of compiler optimization, or even
different versions of the same compiler. Within these constraints,
ESMF shall provide varied levels of bit-reproducibility:

\ssreq{Parallel bit-reproducibility}

An execution mode will be provided which allows an ESMF-based model to
return bitwise identical results from the same executable at different
processor counts, or different parallelism options. This execution
mode is not subject to the performance requirement of Section~\ref{perf}.

\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:} all JMC codes. \\
{\bf Status:} Proposed. \\
{\bf Verification:} System test.
\end{reqlist}

\ssreq{Bit-reproducibility on identical configurations}

The \emph{default} execution mode will allow an ESMF-based model to
return bitwise identical results from the same executable at the same
processor count, with the same parallelism options. This mode
\emph{is} subject to the performance requirement of
Section~\ref{perf}.

\begin{reqlist}
{\bf Priority:} 1.\\
{\bf Source:} all codes. \\
{\bf Status:} Proposed. \\
{\bf Verification:} System test.
\end{reqlist}

\ssreq{Non bit-reproducing fast option}

If a performance enhancement may be had by waiving the default
requirement above, this will be made available in a special execution
mode. In this mode, even two runs at the same processor count, with
the same parallelism options, may not return bitwise identical
results.

\begin{reqlist}
{\bf Priority:} 3 \\
{\bf Source:} NCEP? \\
{\bf Status:} Proposed. \\
{\bf Verification:} System test.
\end{reqlist}

\sreq{Error handling}
The ESMF shall be instrumented for error handling consistly across the
framework.  The user shall receive ample information on errors.
\begin{reqlist}
  {\bf Priority:} 1. \\
  {\bf Source:} Required by all codes. \\
  {\bf Status:} Proposed. \\
  {\bf Verification:} Interface inspection, code inspection, unit
  test, system test.
\end{reqlist}

\sreq{Modularity}
Layers of the framework will be designed to adapt to
restructuring of other parts of the framework and user-supplied components.  
For example, the coupling layers should be able to adapt to different 
implementations and data structures of component models.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for interoperability Milestones I and J. \\
{\bf Status:} Proposed. \\
{\bf Verification:} Interoperability experiments.
\end{reqlist}

\sreq{Ease of Adoption}
It must be straightforward to integrate ESMF into an application 
that is reasonably modular.  We adopt as a goal that such applications should
need to modify no more than 2\% of their source code to utilize the coupling
features of ESMF.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} GFDL, NSIPP. \\
{\bf Status:} Proposed. \\
{\bf Verification:} Line count!
\end{reqlist}

\req{Maintenance and Support Requirement}
The ESMF must be maintained as a long-term commitment by at least one
institution.  This maintenance must extend beyond adaptation to the 
computational environment, and must include an ongoing research component
dedicated to increasing the performance, flexibility and functionality of
the software.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} All participants. \\
{\bf Status:} Proposed. \\
{\bf Verification:} Publicly documented commitment, line item in 
projected budgets.
\end{reqlist}






